<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8" />
        <title>Casual Quiz</title>
        <link rel="stylesheet" th:href="@{/css/casual.css}" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    </head>
    <body>
        <div class="quiz-card">
            <span class="level-label" th:text="'LEVEL ' + ${riddle.level}">
                LEVEL 1
            </span>

            <div class="question-box" th:text="${riddle.question}">
                ここに問題文が表示されます
            </div>

            <div th:if="${riddle.type == 'gojuon'}" class="gojuon-container">
                <div class="gojuon-instruction">
                    <p class="instruction-title">暗号解読ヒント:</p>
                    <p class="instruction-desc">[行 - 段] の文字を拾え。</p>
                    <p class="instruction-example">例: [1-1] → あ、[2-3] → く</p>
                </div>

                <table class="gojuon-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>1<br><small>あ</small></th>
                            <th>2<br><small>い</small></th>
                            <th>3<br><small>う</small></th>
                            <th>4<br><small>え</small></th>
                            <th>5<br><small>お</small></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="row-header">1<small>(あ)</small></td>
                            <td>あ</td>
                            <td>
                                <span th:if="${riddle.id == 6}" class="circled-text">い</span>
                                <span th:unless="${riddle.id == 6}">い</span>
                            </td>
                            <td>う</td>
                            <td>え</td>
                            <td>お</td>
                        </tr>
                        <tr><td class="row-header">2<small>(か)</small></td> <td>か</td><td>き</td><td>く</td><td>け</td><td>こ</td></tr>
                        <tr><td class="row-header">3<small>(さ)</small></td> <td>さ</td><td>し</td><td>す</td><td>せ</td><td>そ</td></tr>
                        <tr><td class="row-header">4<small>(た)</small></td> <td>た</td><td>ち</td><td>つ</td><td>て</td><td>と</td></tr>
                        <tr><td class="row-header">5<small>(な)</small></td> <td>な</td><td>に</td><td>ぬ</td><td>ね</td><td>の</td></tr>
                        <tr><td class="row-header">6<small>(は)</small></td> <td>は</td><td>ひ</td><td>ふ</td><td>へ</td><td>ほ</td></tr>
                        <tr><td class="row-header">7<small>(ま)</small></td> <td>ま</td><td>み</td><td>む</td><td>め</td><td>も</td></tr>
                        <tr><td class="row-header">8<small>(や)</small></td> <td>や</td><td></td><td>ゆ</td><td></td><td>よ</td></tr>
                        <tr><td class="row-header">9<small>(ら)</small></td> <td>ら</td><td>り</td><td>る</td><td>れ</td><td>ろ</td></tr>
                        <tr><td class="row-header">10<small>(わ)</small></td> <td>わ</td><td></td><td>を</td><td></td><td>ん</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 動く解答欄の問題 -->
            <div th:if="${riddle.type == 'moving'}" class="moving-section">
                <div class="alert alert-warning" role="alert">
                    <strong>警告:</strong> 回答欄が逃走中です！<br>
                    下のボタンで動きを止めてから入力してください！
                </div>
                
                <button type="button" id="toggleButton" class="btn btn-danger btn-lg btn-stop-animation">
                    🛑 止まれ！！
                </button>

                <div class="moving-container">
                    <div id="movingForm" class="moving-target">
                        <form th:action="@{/casual/quiz/check}" method="post" class="moving-form-card">
                            <input type="hidden" name="id" th:value="${riddle.id}">
                            <label class="moving-form-label">回答欄</label>
                            <input type="text" name="answer" class="form-control" placeholder="捕まえた！" required autocomplete="off">
                            <button type="submit" class="btn btn-primary btn-moving-submit">回答する</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- トグルスイッチの問題 -->
            <div th:if="${riddle.type == 'toggle'}" class="toggle-section">
                <p>部屋が真っ暗や… ブレーカーが落ちてるみたい。<br>全てのスイッチをONにして！</p>
                
                <div id="bulbIcon" class="light-bulb">💡</div>

                <div class="switch-container">
                    <label class="switch">
                        <input type="checkbox" class="toggle-switch">
                        <span class="slider"></span>
                    </label>
                    <label class="switch">
                        <input type="checkbox" class="toggle-switch">
                        <span class="slider"></span>
                    </label>
                    <label class="switch">
                        <input type="checkbox" class="toggle-switch">
                        <span class="slider"></span>
                    </label>
                </div>

                <p class="toggle-status">電源OFF...</p>
            </div>

            <!-- その他の問題タイプの解答欄 -->
            <div th:if="${riddle.type != 'moving'}" class="answer-section">
                <form th:action="@{/casual/quiz/check}" method="post">
                    <input type="hidden" name="id" th:value="${riddle.id}" />

                    <div th:if="${riddle.type == 'select'}" class="input-container">
                        <select name="answer" class="form-select" required>
                            <option value="" selected disabled>
                                -- 選択してな --
                            </option>
                            <option
                                th:each="opt : ${riddle.options}"
                                th:value="${opt.role}"
                                th:text="${opt.text}"
                            ></option>
                        </select>
                    </div>

                    <div th:if="${riddle.type == 'choice'}" class="choice-grid">
                        <button
                            th:each="opt : ${riddle.options}"
                            type="submit"
                            name="answer"
                            th:value="${opt.role}"
                            class="choice-btn"
                        >
                            <span th:text="${opt.text}">選択肢</span>
                        </button>
                    </div>

                    <div class="input-area" th:if="${riddle.type == 'text' || riddle.type == 'gojuon' || riddle.type == 'toggle'}">
                        <input
                            type="text"
                            name="answer"
                            class="casual-input"
                            placeholder="ここに答えを入れてな"
                            required
                        />
                    </div>
                    <div th:if="${riddle.type != 'choice'}">
                        <button type="submit" class="btn-base btn-submit">
                            送信！
                        </button>
                    </div>
                </form>
            </div>

            <div class="navigation-links">
                <a class="return-list" th:href="@{/casual/list}">一覧に戻る</a>
            </div>
        </div>
        <script th:src="@{/js/script.js}"></script>
    </body>
</html>
